#!/bin/bash

cd ../../..

ts=`date +%F-%R`
demoFolder="cp-demo"
cc="./cp-compile"
rc="./cp-run"

#classes=( "RedBlackTree" "SortedList" )

if [ "$#" -lt "4" ]
then
  echo "Please provide a file name, main class name and bounds for problem size"
  exit 1
fi

filename=${1}
mainclass=${2}
base=${3}
limit=${4}

evalFolder="eval/cp/data/${ts}-${mainclass}"

mkdir -p ${evalFolder}

evalFileBase=${evalFolder}/${mainclass}-${ts}
${cc} axioms scalaEval ${filename} || (echo "Could not compile..." && exit 1)

for (( i=${base}; i<=${limit}; i++ ))
do
  currentFile=${evalFileBase}-${i}
  ${rc} ${mainclass} $i | tee -a ${currentFile}
  cd eval/cp/scripts
  ./generate-graph ../../../${currentFile}
  cd ../../..
done

mv eval/cp/graphs/${mainclass}-${ts}-* ${evalFolder}
